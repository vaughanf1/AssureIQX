---
phase: 07-documentation-and-reports
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - README.md
  - Makefile
autonomous: true

must_haves:
  truths:
    - "README contains complete setup instructions from clone to first result"
    - "README lists all CLI commands with usage examples"
    - "README shows updated project structure including docs/model_card.md and docs/poc_report.md"
    - "README contains NOT FOR CLINICAL USE disclaimer"
    - "README includes results summary with key metrics"
    - "A new developer can reproduce results from scratch following README instructions"
    - "Makefile report target generates documentation (no longer echoes manual message)"
  artifacts:
    - path: "README.md"
      provides: "Complete reproduction guide"
      min_lines: 150
    - path: "Makefile"
      provides: "Updated report target"
      contains: "report:"
  key_links:
    - from: "README.md"
      to: "docs/model_card.md"
      via: "Documentation reference"
      pattern: "model_card\\.md"
    - from: "README.md"
      to: "docs/poc_report.md"
      via: "Documentation reference"
      pattern: "poc_report\\.md"
    - from: "README.md"
      to: "scripts/"
      via: "CLI command documentation"
      pattern: "scripts/(train|eval|infer|gradcam)\\.py"
---

<objective>
Finalize README.md with complete reproduction instructions and verify the end-to-end pipeline is documented.

Purpose: The README is the entry point for any developer. It must enable clean-room reproduction of all results from scratch. This plan also updates the Makefile to properly handle the report target now that documentation files exist.

Output: Updated `README.md` and `Makefile`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-documentation-and-reports/07-01-SUMMARY.md

@README.md
@Makefile
@configs/default.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update README.md with complete reproduction guide</name>
  <files>README.md</files>
  <action>
Rewrite `README.md` to serve as a complete reproduction guide. Keep the existing structure but expand significantly.

**Required sections:**

1. **Title and Badge Area**: "AssureXRay" with one-line description. Add: "NOT FOR CLINICAL USE -- Research Prototype Only"

2. **Overview** (expand existing):
   - What: 3-class bone tumor classification PoC
   - Dataset: BTXRD (3,746 radiographs, 3 centers)
   - Model: EfficientNet-B0 (transfer learning)
   - Key result: Stratified macro AUC 0.846, center-holdout macro AUC 0.627
   - Link to full docs: `docs/model_card.md` and `docs/poc_report.md`

3. **Key Results** (NEW section -- brief summary):

   | Split | Macro AUC | Malignant Sensitivity | Malignant Specificity |
   |-------|-----------|----------------------|----------------------|
   | Stratified | 0.846 (0.814-0.873) | 60.8% (47.4%-74.3%) | 95.7% |
   | Center-holdout | 0.627 (0.594-0.658) | 36.4% (27.0%-44.8%) | 79.9% |

   Then: "See `docs/poc_report.md` for full analysis and `docs/model_card.md` for model documentation."

4. **Setup** (expand existing):
   - Prerequisites: Python 3.10-3.12, pip, ~2GB disk for dataset, optional CUDA
   - Installation: clone, venv, pip install (keep existing code blocks)
   - Verify installation: `python -c "import torch; print(torch.__version__)"`

5. **Quick Start** (NEW section):
   Show the minimal end-to-end pipeline:
   ```bash
   # Full pipeline (download -> audit -> split -> train -> evaluate -> gradcam)
   make all

   # Or step by step:
   make download    # Download BTXRD dataset (~1.5GB)
   make audit       # Generate data audit report
   make split       # Create train/val/test splits
   make train-all   # Train on both split strategies
   make evaluate    # Full evaluation with metrics and plots
   make gradcam     # Generate Grad-CAM heatmaps
   ```

6. **CLI Reference** (expand existing "Available Commands"):
   For each command, show the make target AND the underlying Python command with common options:

   ```bash
   # Download dataset
   make download
   python scripts/download.py --config configs/default.yaml

   # Audit dataset
   make audit
   python scripts/audit.py --config configs/default.yaml

   # Create splits
   make split
   python scripts/split.py --config configs/default.yaml

   # Train (single split)
   make train
   python scripts/train.py --config configs/default.yaml

   # Train (both splits)
   make train-all
   python scripts/train.py --config configs/default.yaml --override training.split_strategy=stratified
   python scripts/train.py --config configs/default.yaml --override training.split_strategy=center

   # Evaluate
   make evaluate
   python scripts/eval.py --config configs/default.yaml

   # Grad-CAM
   make gradcam
   python scripts/gradcam.py --config configs/default.yaml

   # Single-image inference
   python scripts/infer.py --image path/to/image.jpg --checkpoint checkpoints/best_stratified.pt

   # Batch inference
   python scripts/infer.py --input-dir path/to/images/ --checkpoint checkpoints/best_stratified.pt

   # Streamlit demo
   make demo
   ```

7. **Project Structure** (update existing):
   Update the tree to include docs/model_card.md, docs/poc_report.md, and show results/ contents:
   ```
   AssureXRay/
   ├── configs/default.yaml          # Central configuration
   ├── scripts/                      # CLI entry points
   │   ├── download.py               # Dataset download
   │   ├── audit.py                  # Data quality audit
   │   ├── split.py                  # Train/val/test splitting
   │   ├── train.py                  # Model training
   │   ├── eval.py                   # Evaluation metrics
   │   ├── gradcam.py                # Grad-CAM generation
   │   └── infer.py                  # Inference CLI
   ├── src/
   │   ├── data/                     # Dataset, transforms, splits
   │   ├── models/                   # EfficientNet-B0 classifier
   │   ├── evaluation/               # Metrics, visualization, CIs
   │   ├── explainability/           # Grad-CAM module
   │   └── utils/                    # Reproducibility, config
   ├── docs/
   │   ├── model_card.md             # Model card (Mitchell et al. 2019)
   │   ├── poc_report.md             # Proof-of-concept report
   │   ├── data_audit_report.md      # Data quality audit
   │   └── dataset_spec.md           # Dataset specification
   ├── results/                      # Evaluation outputs
   │   ├── stratified/               # Stratified split results
   │   ├── center_holdout/           # Center-holdout results
   │   ├── gradcam/                  # Grad-CAM galleries
   │   └── inference/                # Inference outputs
   ├── checkpoints/                  # Saved model weights
   ├── data/splits/                  # Split manifests (CSV)
   ├── app/                          # Streamlit demo
   └── Makefile                      # Pipeline orchestration
   ```

8. **Configuration** (expand existing):
   - Explain `configs/default.yaml` structure
   - Show override syntax: `--override training.batch_size=64`

9. **Documentation**:
   - Link to `docs/model_card.md` -- Model architecture, performance, limitations
   - Link to `docs/poc_report.md` -- Full analysis with clinical framing
   - Link to `docs/data_audit_report.md` -- Data quality findings
   - Link to `docs/dataset_spec.md` -- Column definitions and label schema

10. **License and Disclaimer** (keep existing but ensure):
    - CC BY-NC-ND 4.0 for BTXRD dataset
    - **NOT FOR CLINICAL USE** disclaimer (bold, prominent)
    - Research prototype only

11. **Citation**:
    - BTXRD paper: Yao et al., Scientific Data 2025, DOI link
  </action>
  <verify>
Verify README completeness:
```bash
wc -l README.md
```
Should be 150+ lines.

Verify key sections:
```bash
grep -c "Quick Start\|CLI Reference\|Key Results\|NOT FOR CLINICAL USE\|model_card.md\|poc_report.md" README.md
```
Should return 6+ matches.

Verify reproduction commands:
```bash
grep -c "make download\|make audit\|make split\|make train\|make evaluate\|make gradcam\|scripts/infer.py" README.md
```
Should return 7+ matches.
  </verify>
  <done>
README.md contains complete setup instructions, quick start guide, CLI reference with all commands, updated project structure, key results table, documentation links, and NOT FOR CLINICAL USE disclaimer. A new developer can follow it to reproduce all results from scratch.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Makefile report target and verify pipeline documentation</name>
  <files>Makefile</files>
  <action>
Update the Makefile `report` target to no longer echo a manual message. Since model_card.md and poc_report.md are written manually (by Claude), the report target should verify they exist rather than generate them.

Replace the existing report target:
```makefile
report: ## Verify documentation is complete (model card + PoC report)
	@test -f docs/model_card.md || (echo "ERROR: docs/model_card.md not found" && exit 1)
	@test -f docs/poc_report.md || (echo "ERROR: docs/poc_report.md not found" && exit 1)
	@echo "Documentation verified:"
	@echo "  - docs/model_card.md ($(shell wc -l < docs/model_card.md) lines)"
	@echo "  - docs/poc_report.md ($(shell wc -l < docs/poc_report.md) lines)"
	@echo "  - docs/data_audit_report.md"
	@echo "  - docs/dataset_spec.md"
```

Also update the `all` target to include `train-all` instead of just `train` (since we train both splits), and add `infer` if not present. The `all` target should represent the full pipeline:
```makefile
all: download audit split train-all evaluate gradcam report ## Run full pipeline end-to-end
```

Verify the final Makefile is consistent with README CLI documentation.
  </action>
  <verify>
Run the make help target:
```bash
make help
```
Verify `report` target description is updated.

Run the report target to verify it checks for files:
```bash
make report
```
Should succeed if docs/model_card.md and docs/poc_report.md exist from plan 07-01.
  </verify>
  <done>
Makefile `report` target verifies documentation completeness instead of echoing manual message. `all` target includes `train-all` for both splits. Pipeline documentation in README matches Makefile targets.
  </done>
</task>

</tasks>

<verification>
1. README serves as complete reproduction guide:
   ```bash
   # Check all key sections exist
   grep "Quick Start" README.md && \
   grep "CLI Reference" README.md && \
   grep "Key Results" README.md && \
   grep "NOT FOR CLINICAL USE" README.md && \
   grep "model_card.md" README.md && \
   grep "poc_report.md" README.md
   ```

2. Makefile pipeline works:
   ```bash
   make help  # All targets listed
   make report  # Documentation verification passes
   ```

3. README + Makefile consistency: Every `make` target in README exists in Makefile.

4. Numbers in README Key Results table match JSON files:
   - Stratified macro AUC 0.846, center-holdout 0.627
</verification>

<success_criteria>
- README.md enables clean-room reproduction from clone to results
- README includes Quick Start, CLI Reference, Key Results, Documentation links
- README references docs/model_card.md and docs/poc_report.md
- NOT FOR CLINICAL USE disclaimer present in README
- Makefile report target verifies documentation exists
- Makefile all target represents the complete pipeline
- All CLI commands in README match actual script arguments
</success_criteria>

<output>
After completion, create `.planning/phases/07-documentation-and-reports/07-02-SUMMARY.md`
</output>
